---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Hero from '@/components/HeroClean.astro';
import { getPaginatedPhotos } from '../utils/wordpress-api-paginated';

// Get page number from URL params
const url = new URL(Astro.request.url);
const currentPage = parseInt(url.searchParams.get('page') || '1');

// Fetch paginated photos
const paginatedData = await getPaginatedPhotos(currentPage, 9);
const { photos, totalPages, hasNextPage, hasPrevPage } = paginatedData;
---

<BaseLayout 
  title={`Galería - Página ${currentPage} - Lo del Nico`}
  description="Galería de fotografía personal de Nicolas desde Buenos Aires, Argentina."
>
  <Hero />
  
  <main class="photos-section">
    <!-- Photo Grid -->
    <div class="photo-grid">
      {photos.map((photo, index) => (
        <div class="photo-item">
          <img 
            src={photo.src} 
            alt={photo.alt}
            loading="lazy"
          />
        </div>
      ))}
    </div>
    
    <!-- Pagination -->
    <div class="pagination">
      <span class="page-info">{currentPage.toString().padStart(2, '0')} / {totalPages.toString().padStart(2, '0')}</span>
      <div class="page-controls">
        {hasPrevPage && (
          <a href={`/gallery?page=${currentPage - 1}`} class="page-btn" aria-label="Página anterior">←</a>
        )}
        {hasNextPage && (
          <a href={`/gallery?page=${currentPage + 1}`} class="page-btn" aria-label="Página siguiente">→</a>
        )}
      </div>
    </div>
  </main>
</BaseLayout>

<style>
  @import '../styles/layout/sections.css';
  @import '../styles/components/photo-grid.css';
  @import '../styles/components/pagination.css';
</style>
