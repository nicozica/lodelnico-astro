---
// Gallery pagination: 3x3 grid with 4:3 aspect ratio images, clean design
import BaseLayout from '../layouts/BaseLayout.astro';
import type { PhotoItem } from '../types/photoblog';
import he from 'he';

interface Props {
  photos: PhotoItem[];
  currentPage: number;
  totalPages: number;
  hasNextPage: boolean;
  hasPrevPage: boolean;
}

// Generate static paths for all pages (9 items per page)
export async function getStaticPaths() {
  // Import the photoblog data generated at build time
  const photoblogData = await import('../data/photoblog.json');
  const photos = photoblogData.default as PhotoItem[];
  
  const photosPerPage = 9;
  const totalPages = Math.ceil(photos.length / photosPerPage);
  
  return Array.from({ length: totalPages }, (_, i) => {
    const page = i + 1;
    const startIndex = i * photosPerPage;
    const endIndex = startIndex + photosPerPage;
    const pagePhotos = photos.slice(startIndex, endIndex);
    
    return {
      params: { page: page.toString() },
      props: {
        photos: pagePhotos,
        currentPage: page,
        totalPages,
        hasNextPage: page < totalPages,
        hasPrevPage: page > 1
      } satisfies Props
    };
  });
}

// Get props from getStaticPaths
const { photos: pagePhotos, currentPage, totalPages } = Astro.props as Props;
---

<BaseLayout 
  title={`Gallery - Page ${currentPage} - Lo del Nico`}
  description="Personal photography gallery by Nicolas from Buenos Aires, Argentina."
>
  <div class="gallery-container">
    <!-- Photo Grid - Only Images (3x3 layout with 4:3 aspect ratio) -->
    <div class="photo-grid">
      {pagePhotos.map((photo: PhotoItem) => (
        <a 
          href={`/photo/${photo.id}/?from=${currentPage}`} 
          class="photo-link"
          aria-label={he.decode(photo.title)}
        >
          <img 
            src={photo.image} 
            alt={he.decode(photo.title)}
            loading="lazy"
            class="photo-img"
            width="400"
            height="400"
          />
        </a>
      ))}
    </div>
    
    <!-- Swiss-style minimal pagination -->
    <nav class="gallery-pager" aria-label="Gallery pagination">
      <span class="count">{String(currentPage).padStart(2,"0")} / {String(totalPages).padStart(2,"0")}</span>
      <div class="nav">
        <a 
          class={`arrow ${currentPage <= 1 ? "disabled" : ""}`} 
          href={`/${currentPage - 1}/`} 
          aria-label="Previous"
        >
          <img src="/arrow-left.svg" alt="Previous" class="arrow-icon" />
        </a>
        <a 
          class={`arrow ${currentPage >= totalPages ? "disabled" : ""}`} 
          href={`/${currentPage + 1}/`} 
          aria-label="Next"
        >
          <img src="/arrow-right.svg" alt="Next" class="arrow-icon" />
        </a>
      </div>
    </nav>

    <!-- Gallery footer - Swiss minimal style -->
    <footer class="gallery-footer">
      <div class="footer-row">
        <div class="footer-about">
          Diseñador de Imagen y Sonido.<br/>
          Entusiasta de la música, la <a href="https://www.blurfm.com" target="_blank" rel="noopener">radio</a> y el cine.<br/>
          Amante del cielo, las estrellas y la Wikipedia.
        </div>
        <div class="footer-logos">
          <a href="https://www.blurfm.com" target="_blank" rel="noopener">
            <img src="/logo_blurfm.svg" alt="blur fm" />
          </a>
          <a href="https://www.nico.ar" target="_blank" rel="noopener">
            <img src="/logo_nico.svg" alt="nico.ar" />
          </a>
        </div>
      </div>
      <hr class="footer-rule" />
      <div class="container footer-powered">Powered by <a href="https://www.argensonix.com" target="_blank" rel="noopener">Argensonix Multimedia</a></div>
    </footer>
  </div>
</BaseLayout>
