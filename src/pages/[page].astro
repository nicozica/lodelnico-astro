---
// Gallery pagination: 3x3 grid with 4:3 aspect ratio images, clean design
import BaseLayout from '../layouts/BaseLayout.astro';
import type { PhotoItem } from '../types/photoblog';

interface Props {
  photos: PhotoItem[];
  currentPage: number;
  totalPages: number;
  hasNextPage: boolean;
  hasPrevPage: boolean;
}

// Generate static paths for all pages (9 items per page)
export async function getStaticPaths() {
  // Import the photoblog data generated at build time
  const photoblogData = await import('../data/photoblog.json');
  const photos = photoblogData.default as PhotoItem[];
  
  const photosPerPage = 9;
  const totalPages = Math.ceil(photos.length / photosPerPage);
  
  return Array.from({ length: totalPages }, (_, i) => {
    const page = i + 1;
    const startIndex = i * photosPerPage;
    const endIndex = startIndex + photosPerPage;
    const pagePhotos = photos.slice(startIndex, endIndex);
    
    return {
      params: { page: page.toString() },
      props: {
        photos: pagePhotos,
        currentPage: page,
        totalPages,
        hasNextPage: page < totalPages,
        hasPrevPage: page > 1
      } satisfies Props
    };
  });
}

// Get props from getStaticPaths
const { photos: pagePhotos, currentPage, totalPages, hasNextPage, hasPrevPage } = Astro.props as Props;
---

<BaseLayout 
  title={`Gallery - Page ${currentPage} - Lo del Nico`}
  description="Personal photography gallery by Nicolas from Buenos Aires, Argentina."
>
  <div class="gallery-container">
    <!-- Photo Grid - Only Images (3x3 layout with 4:3 aspect ratio) -->
    <div class="photo-grid">
      {pagePhotos.map((photo: PhotoItem) => (
        <a 
          href={`/photo/${photo.id}/?from=${currentPage}`} 
          class="photo-link"
          aria-label={photo.title}
        >
          <img 
            src={photo.image} 
            alt={photo.title}
            loading="lazy"
            class="photo-img"
            width="400"
            height="400"
          />
        </a>
      ))}
    </div>
    
    <!-- Simple Pagination -->
    <nav class="pagination" aria-label="Gallery pagination">
      <span class="page-info">
        Page {currentPage} of {totalPages}
      </span>
      <div class="page-controls">
        {hasPrevPage && (
          <a href={`/${currentPage - 1}/`} class="page-btn" aria-label="Previous page">← Prev</a>
        )}
        {hasNextPage && (
          <a href={`/${currentPage + 1}/`} class="page-btn" aria-label="Next page">Next →</a>
        )}
      </div>
    </nav>
  </div>
</BaseLayout>
