---
import { getMediaPaginatedPhotos } from '../utils/wordpress-media-api';

let debugInfo = {};
let error = null;

try {
  console.log('Testing WordPress Media API...');
  const result = await getMediaPaginatedPhotos(1, 9);
  console.log('Media API Result:', result);
  
  debugInfo = {
    totalPhotos: result.photos.length,
    totalPages: result.totalPages,
    currentPage: result.currentPage,
    hasNextPage: result.hasNextPage,
    hasPrevPage: result.hasPrevPage,
    firstFewPhotos: result.photos.slice(0, 3).map(photo => ({
      id: photo.id,
      title: photo.title.substring(0, 50) + '...',
      src: photo.src,
      alt: photo.alt.substring(0, 30) + '...'
    })),
    allPhotoIds: result.photos.map(p => p.id)
  };
} catch (err: any) {
  console.error('Error in media debug:', err);
  error = err.message;
}
---

<!DOCTYPE html>
<html>
<head>
  <title>WordPress Media API Debug</title>
  <style>
    body { font-family: monospace; margin: 40px; }
    .error { color: red; }
    .success { color: green; }
    pre { background: #f5f5f5; padding: 20px; overflow-x: auto; }
    .photo-preview { display: flex; gap: 10px; flex-wrap: wrap; margin: 20px 0; }
    .photo-preview img { width: 150px; height: 150px; object-fit: cover; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>WordPress Media API Debug</h1>
  
  {error && (
    <div class="error">
      <h2>❌ Error:</h2>
      <p>{error}</p>
    </div>
  )}
  
  {!error && debugInfo && (debugInfo as any).totalPhotos > 0 && (
    <div class="success">
      <h2>✅ Media API funcionando - {(debugInfo as any).totalPhotos} fotos encontradas</h2>
    </div>
  )}
  
  {!error && debugInfo && (debugInfo as any).totalPhotos === 0 && (
    <div class="error">
      <h2>⚠️ No se encontraron fotos en la media library</h2>
    </div>
  )}
  
  <h2>Información de Debug:</h2>
  <pre>{JSON.stringify(debugInfo, null, 2)}</pre>
  
  {!error && debugInfo && (debugInfo as any).firstFewPhotos && (
    <div>
      <h2>Vista previa de primeras fotos:</h2>
      <div class="photo-preview">
        {((debugInfo as any).firstFewPhotos).map((photo: any) => (
          <div>
            <img src={photo.src} alt={photo.alt} />
            <p style="margin: 5px 0; font-size: 12px;">{photo.title}</p>
          </div>
        ))}
      </div>
    </div>
  )}
  
  <h2>Enlaces:</h2>
  <p>
    <a href="/">← Inicio</a> | 
    <a href="/gallery">Galería</a> | 
    <a href="/test-media">Test con Media API</a>
  </p>
</body>
</html>
